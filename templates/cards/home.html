{% extends "base.html" %}
{% load i18n %}
{% load card_filters %}

{% block title %}EMTEEGEE - Magic: The Gathering Analysis Platform{% endblock %}

{% block content %}
<div class="container-xxl">
    <!-- Hero Section -->
    <div class="hero-home-section">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <div class="hero-content">
                    <h1 class="hero-home-title">
                        <span class="brand-icon">ðŸŽ´</span>
                        <span class="brand-name">EMTEEGEE</span>
                    </h1>
                    <p class="hero-subtitle">Advanced Magic: The Gathering Analysis Platform</p>
                    <p class="hero-description">
                        Discover deeper insights into your favorite MTG cards with AI-powered analysis, 
                        comprehensive card data, and intelligent deck building recommendations.
                    </p>                    <div class="hero-actions">
                        {% if user.is_authenticated %}
                            <button type="button" class="btn btn-primary btn-lg me-3" data-bs-toggle="modal" data-bs-target="#quickSearchModal">
                                <i class="bi bi-search"></i> Find a Card
                            </button>
                            <a href="{% url 'cards:analysis_dashboard' %}" class="btn btn-outline-primary btn-lg">
                                <i class="bi bi-graph-up"></i> Analysis Dashboard
                            </a>
                        {% else %}
                            <a href="{% url 'account_login' %}" class="btn btn-primary btn-lg me-3">
                                <i class="bi bi-box-arrow-in-right"></i> Get Started
                            </a>
                            <a href="/abyss/" class="btn btn-outline-primary btn-lg">
                                <i class="bi bi-eye"></i> The Abyss
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="hero-stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-collection"></i></div>
                        <div class="stat-content">
                            <div class="stat-number">{{ card_count|default:"32,000+" }}</div>
                            <div class="stat-label">Magic Cards</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-cpu"></i></div>
                        <div class="stat-content">
                            <div class="stat-number">{{ analysis_progress.analyzed_cards|default:"1,200+" }}</div>
                            <div class="stat-label">AI Analyzed</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-graph-up"></i></div>
                        <div class="stat-content">
                            <div class="stat-number">20</div>
                            <div class="stat-label">Analysis Types</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="bi bi-people"></i></div>
                        <div class="stat-content">
                            <div class="stat-number">{{ user_count|default:"500+" }}</div>
                            <div class="stat-label">Active Users</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Featured Cards Section -->
    {% if featured_cards %}
    <section class="featured-section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="bi bi-stars"></i> Featured Analysis
            </h2>
            <p class="section-subtitle">Cards with complete AI analysis and insights</p>
        </div>
        <div class="row g-4">
            {% for card in featured_cards %}
                <div class="col-lg-4 col-md-6">
                    <div class="featured-card">
                        <div class="card-image-wrapper">
                            {% with card|card_image:'small' as card_image_url %}
                                {% if card_image_url %}
                                    <img src="{{ card_image_url }}" alt="{{ card.name }}" class="featured-card-image">
                                {% else %}
                                    <div class="featured-card-placeholder">
                                        <i class="bi bi-image"></i>
                                    </div>
                                {% endif %}
                            {% endwith %}
                        </div>
                        <div class="featured-card-content">
                            <h3 class="featured-card-title">{{ card.name }}</h3>
                            <p class="featured-card-type">{{ card.type|format_card_types }}</p>
                            <div class="featured-card-meta">
                                {% if card.rarity %}
                                    <span class="rarity-badge-sm {{ card.rarity }}">{{ card.rarity|title }}</span>
                                {% endif %}
                                {% if card.setCode %}
                                    <span class="set-badge">{{ card.setCode|upper }}</span>
                                {% endif %}
                            </div>
                            <a href="{% url 'cards:card_detail' card.uuid %}" class="featured-card-link">
                                View Analysis <i class="bi bi-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Recent Cards Section -->
    {% if recent_cards %}
    <section class="recent-section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="bi bi-clock-history"></i> Recently Added
            </h2>
            <p class="section-subtitle">Latest cards in our database</p>
        </div>
        <div class="row g-3">
            {% for card in recent_cards %}
                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                    <div class="recent-card">
                        <div class="recent-card-image">
                            {% with card|card_image:'small' as card_image_url %}
                                {% if card_image_url %}
                                    <img src="{{ card_image_url }}" alt="{{ card.name }}">
                                {% else %}
                                    <div class="recent-card-placeholder">
                                        <i class="bi bi-image"></i>
                                    </div>
                                {% endif %}
                            {% endwith %}
                        </div>
                        <div class="recent-card-info">
                            <h4 class="recent-card-name">{{ card.name }}</h4>
                            {% if card.setCode %}
                                <small class="recent-card-set">{{ card.setCode|upper }}</small>
                            {% endif %}
                        </div>
                        <a href="{% url 'cards:card_detail' card.uuid %}" class="recent-card-overlay">
                            <i class="bi bi-eye"></i>
                        </a>
                    </div>
                </div>
            {% endfor %}
        </div>        <div class="text-center mt-4">
            <a href="/abyss/" class="btn btn-outline-primary">
                <i class="bi bi-grid"></i> Enter The Abyss
            </a>
        </div>
    </section>
    {% endif %}

    <!-- Features Section -->
    <section class="features-section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="bi bi-lightning"></i> Platform Features
            </h2>
            <p class="section-subtitle">Everything you need for MTG analysis and deck building</p>
        </div>
        <div class="row g-4">
            <div class="col-lg-4 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-robot"></i>
                    </div>
                    <h3 class="feature-title">AI Analysis</h3>
                    <p class="feature-description">
                        Get deep insights with 20 different AI analysis types including tactical analysis, 
                        combo suggestions, and power level assessments.
                    </p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-database"></i>
                    </div>
                    <h3 class="feature-title">Complete Database</h3>
                    <p class="feature-description">
                        Access comprehensive data on all Magic cards with images, pricing, 
                        legalities, and real-time market information.
                    </p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-graph-up"></i>
                    </div>
                    <h3 class="feature-title">Market Insights</h3>
                    <p class="feature-description">
                        Track card values with international pricing (USD/EUR), EDHREC rankings, 
                        and investment outlook analysis.
                    </p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-layers"></i>
                    </div>
                    <h3 class="feature-title">Deck Building</h3>
                    <p class="feature-description">
                        Build better decks with synergy analysis, archetype recommendations, 
                        and meta positioning insights.
                    </p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-search"></i>
                    </div>
                    <h3 class="feature-title">Advanced Search</h3>
                    <p class="feature-description">
                        Find exactly what you need with powerful filtering by format, 
                        color, type, rarity, and analysis completion.
                    </p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-shield-check"></i>
                    </div>
                    <h3 class="feature-title">Format Legality</h3>
                    <p class="feature-description">
                        Stay compliant with up-to-date format legality information 
                        for Standard, Modern, Legacy, and Commander.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    {% if not user.is_authenticated %}
    <section class="cta-section">
        <div class="cta-content">
            <h2 class="cta-title">Ready to Level Up Your MTG Game?</h2>
            <p class="cta-description">
                Join thousands of players using EMTEEGEE to build better decks, 
                understand the meta, and make smarter card choices.
            </p>
            <div class="cta-actions">
                <a href="{% url 'account_signup' %}" class="btn btn-primary btn-lg">
                    <i class="bi bi-person-plus"></i> Sign Up Free
                </a>
                <a href="{% url 'account_login' %}" class="btn btn-link btn-lg">
                    Already have an account? <strong>Sign In</strong>
                </a>
            </div>
        </div>
    </section>
    {% endif %}
</div>

<!-- Quick Search Modal -->
<div class="modal fade" id="quickSearchModal" tabindex="-1" aria-labelledby="quickSearchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="quickSearchModalLabel">
                    <i class="bi bi-search"></i> Quick Card Search
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="quickSearchForm" action="/abyss/" method="get">
                    <div class="mb-3">
                        <label for="cardNameSearch" class="form-label">Search by Card Name</label>
                        <input type="text" class="form-control form-control-lg" id="cardNameSearch" name="q" 
                               placeholder="Enter card name (e.g., Lightning Bolt, Sol Ring...)" 
                               autocomplete="off">
                        <div class="form-text">Start typing to find cards by name</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="colorFilter" class="form-label">Colors</label>
                                <select class="form-select" id="colorFilter" name="colors">
                                    <option value="">Any Color</option>
                                    <option value="W">White</option>
                                    <option value="U">Blue</option>
                                    <option value="B">Black</option>
                                    <option value="R">Red</option>
                                    <option value="G">Green</option>
                                    <option value="C">Colorless</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="rarityFilter" class="form-label">Rarity</label>
                                <select class="form-select" id="rarityFilter" name="rarity">
                                    <option value="">Any Rarity</option>
                                    <option value="common">Common</option>
                                    <option value="uncommon">Uncommon</option>
                                    <option value="rare">Rare</option>
                                    <option value="mythic">Mythic Rare</option>
                                </select>
                            </div>
                        </div>
                    </div>
                      <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="typeFilter" class="form-label">Card Type</label>
                                <select class="form-select" id="typeFilter" name="type">
                                    <option value="">Any Type</option>
                                    <option value="creature">Creature</option>
                                    <option value="instant">Instant</option>
                                    <option value="sorcery">Sorcery</option>
                                    <option value="enchantment">Enchantment</option>
                                    <option value="artifact">Artifact</option>
                                    <option value="planeswalker">Planeswalker</option>
                                    <option value="land">Land</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="setFilter" class="form-label">Set</label>
                                <input type="text" class="form-control" id="setFilter" name="set" 
                                       placeholder="e.g., MH3, DOM, etc.">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pricing Filters -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="priceCurrencyModal" class="form-label">Currency</label>
                                <select class="form-select" id="priceCurrencyModal" name="price_currency">
                                    <option value="usd">USD ($)</option>
                                    <option value="eur">EUR (â‚¬)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="priceMinModal" class="form-label">Min Price</label>
                                <input type="number" class="form-control" id="priceMinModal" name="price_min" 
                                       placeholder="0.00" step="0.01" min="0">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="priceMaxModal" class="form-label">Max Price</label>
                                <input type="number" class="form-control" id="priceMaxModal" name="price_max" 
                                       placeholder="1000.00" step="0.01" min="0">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label class="form-label">Quick Price</label>
                                <div class="d-flex gap-1">
                                    <button type="button" class="btn btn-outline-success btn-sm flex-fill" onclick="setModalQuickPrice('budget')">
                                        Budget
                                    </button>
                                    <button type="button" class="btn btn-outline-warning btn-sm flex-fill" onclick="setModalQuickPrice('mid')">
                                        Mid
                                    </button>
                                    <button type="button" class="btn btn-outline-danger btn-sm flex-fill" onclick="setModalQuickPrice('high')">
                                        High
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i> Cancel
                </button>
                <button type="submit" form="quickSearchForm" class="btn btn-primary">
                    <i class="bi bi-search"></i> Search The Abyss
                </button>
            </div>        </div>
    </div>
</div>

<script>
function setModalQuickPrice(type) {
    const minInput = document.getElementById('priceMinModal');
    const maxInput = document.getElementById('priceMaxModal');
    const currencySelect = document.getElementById('priceCurrencyModal');
    
    currencySelect.value = 'usd';
    
    if (type === 'budget') {
        minInput.value = '';
        maxInput.value = '1';
    } else if (type === 'mid') {
        minInput.value = '1';
        maxInput.value = '10';
    } else if (type === 'high') {
        minInput.value = '20';
        maxInput.value = '';
    }
}
</script>
{% endblock %}
