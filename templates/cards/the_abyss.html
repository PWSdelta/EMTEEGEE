{% extends "base.html" %}
{% load i18n %}
{% load card_filters %}

{% block title %}The Abyss - Card Discovery{% endblock %}

{% block content %}
<div class="container-xxl">
    <!-- Abyss Header -->
    <div class="abyss-header">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="abyss-title">
                    <span class="abyss-icon">üï≥Ô∏è</span>
                    <span class="abyss-name">The Abyss</span>
                </h1>
                <p class="abyss-subtitle">
                    {% if is_search %}
                        {% if search_query %}
                            Search results for "{{ search_query }}"
                        {% else %}
                            Filtered card results
                        {% endif %}
                    {% else %}
                        Dive deep into the vast collection of Magic cards. Search, discover, and explore.
                    {% endif %}
                </p>
            </div>            <div class="col-lg-4 text-lg-end">
                <div class="abyss-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ total_cards|default:"0" }}</div>
                        <div class="stat-label">
                            {% if is_search %}Found{% else %}Total{% endif %} Cards
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>    <!-- Simple, Powerful Search -->
    <div class="abyss-search-hero">
        <form method="get" class="abyss-search-form">
            <div class="search-input-container">
                <input type="text" class="form-control abyss-search-input" name="q" 
                       value="{{ search_query }}" 
                       placeholder="Search for any Magic card... (name, text, type, artist, set)"
                       autocomplete="off"
                       autofocus>
                <button type="submit" class="btn btn-primary abyss-search-btn">
                    <i class="bi bi-search"></i>
                    <span class="btn-text">Search</span>
                </button>
            </div>
            {% if search_query %}
                <div class="search-meta">
                    <a href="/abyss/" class="clear-search">
                        <i class="bi bi-x-circle"></i> Clear search
                    </a>
                </div>
            {% endif %}
        </form>
    </div>    <!-- Cards Grid -->
    {% if cards %}
    <div class="abyss-cards-section">
        <div class="abyss-cards-grid">
            {% for card in cards %}                <div class="abyss-card">
                    <div class="abyss-card-image">
                        {% with card|card_image:'normal' as card_image_url %}
                            {% if card_image_url %}
                                <img src="{{ card_image_url }}" alt="{{ card.name }}" loading="lazy">
                            {% else %}
                                <div class="abyss-card-placeholder">
                                    <i class="bi bi-image"></i>
                                </div>
                            {% endif %}
                        {% endwith %}
                    </div>
                    <div class="abyss-card-info">
                        <h3 class="abyss-card-name">{{ card.name }}</h3>
                        <p class="abyss-card-type">{{ card.type|format_card_types }}</p>
                        <div class="abyss-card-meta">
                            {% if card.rarity %}
                                <span class="rarity-dot {{ card.rarity }}"></span>
                            {% endif %}
                        </div>
                    </div>
                    <a href="{% url 'cards:card_detail' card.uuid %}" class="abyss-card-link">
                        <span class="abyss-card-overlay">
                            <i class="bi bi-eye-fill"></i>
                            <span class="overlay-text">View Card</span>
                        </span>
                    </a>
                </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if total_pages > 1 %}
        <div class="abyss-pagination">
            <nav aria-label="Card navigation">
                <ul class="pagination justify-content-center">                    {% if has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?{% if search_query %}q={{ search_query }}&{% endif %}page={{ previous_page }}">
                                <i class="bi bi-chevron-left"></i> Previous
                            </a>
                        </li>
                    {% endif %}
                    
                    {% for page_num in "123456789"|make_list %}
                        {% if page_num|add:0 <= total_pages %}
                            <li class="page-item {% if page_num|add:0 == page %}active{% endif %}">
                                <a class="page-link" href="?{% if search_query %}q={{ search_query }}&{% endif %}page={{ page_num }}">{{ page_num }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?{% if search_query %}q={{ search_query }}&{% endif %}page={{ next_page }}">
                                Next <i class="bi bi-chevron-right"></i>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        {% endif %}
    </div>
    {% elif is_search %}
        <div class="abyss-no-results">
            <div class="no-results-content">
                <i class="bi bi-search"></i>
                <h2>No Cards Found</h2>
                <p>Try adjusting your search terms or filters.</p>
                <a href="/abyss/" class="btn btn-primary">
                    <i class="bi bi-arrow-left"></i> Back to The Abyss
                </a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
